import React, { useState, useEffect } from 'react';
import { Film, Star, Clapperboard, Award, Volume2, SkipForward, RotateCcw } from 'lucide-react';

// --- Data ---
const quizData = [
  {
    id: 1,
    dialogue: "Kitne aadmi the?",
    correct: "Sholay",
    options: ["Sholay", "Deewaar", "Zanjeer", "Don"],
    actor: "Amjad Khan (Gabbar Singh)"
  },
  {
    id: 2,
    dialogue: "Mere paas maa hai.",
    correct: "Deewaar",
    options: ["Trishul", "Deewaar", "Shakti", "Amar Akbar Anthony"],
    actor: "Shashi Kapoor"
  },
  {
    id: 3,
    dialogue: "Bade bade deshon mein aisi chhoti chhoti baatein hoti rehti hai, Senorita.",
    correct: "Dilwale Dulhania Le Jayenge",
    options: ["Kuch Kuch Hota Hai", "Dil To Pagal Hai", "Dilwale Dulhania Le Jayenge", "Mohabbatein"],
    actor: "Shah Rukh Khan"
  },
  {
    id: 4,
    dialogue: "Mogambo khush hua!",
    correct: "Mr. India",
    options: ["Shaan", "Mr. India", "Tezaab", "Karma"],
    actor: "Amrish Puri"
  },
  {
    id: 5,
    dialogue: "Rishte mein toh hum tumhare baap lagte hain, naam hai Shahenshah.",
    correct: "Shahenshah",
    options: ["Agneepath", "Kaalia", "Shahenshah", "Hum"],
    actor: "Amitabh Bachchan"
  },
  {
    id: 6,
    dialogue: "Pushpa, I hate tears.",
    correct: "Amar Prem",
    options: ["Aradhana", "Kati Patang", "Amar Prem", "Safar"],
    actor: "Rajesh Khanna"
  },
  {
    id: 7,
    dialogue: "Thappad se darr nahi lagta sahab, pyaar se lagta hai.",
    correct: "Dabangg",
    options: ["Wanted", "Dabangg", "Bodyguard", "Singham"],
    actor: "Sonakshi Sinha"
  },
  {
    id: 8,
    dialogue: "Ek chutki sindoor ki keemat tum kya jaano Ramesh babu?",
    correct: "Om Shanti Om",
    options: ["Devdas", "Om Shanti Om", "Chennai Express", "Happy New Year"],
    actor: "Deepika Padukone"
  },
  {
    id: 9,
    dialogue: "Don ko pakadna mushkil hi nahi, namumkin hai.",
    correct: "Don",
    options: ["Don", "Dhoom", "Race", "Krrish"],
    actor: "Amitabh Bachchan / Shah Rukh Khan"
  },
  {
    id: 10,
    dialogue: "Picture abhi baaki hai mere dost!",
    correct: "Om Shanti Om",
    options: ["Kal Ho Naa Ho", "Om Shanti Om", "Main Hoon Na", "Billu"],
    actor: "Shah Rukh Khan"
  },
  {
    id: 11,
    dialogue: "Tareekh pe tareekh, tareekh pe tareekh, tareekh pe tareekh milti rahi hai...",
    correct: "Damini",
    options: ["Ghayal", "Damini", "Ghatak", "Border"],
    actor: "Sunny Deol"
  },
  {
    id: 12,
    dialogue: "Main apni favorite hoon.",
    correct: "Jab We Met",
    options: ["Jab We Met", "Love Aaj Kal", "Cocktail", "Tamasha"],
    actor: "Kareena Kapoor Khan"
  }
];

// --- Components ---

const Button = ({ children, onClick, variant = 'primary', className = '', disabled = false }) => {
  const baseStyle = "font-bold py-3 px-6 rounded-lg transform transition-all duration-150 active:scale-95 shadow-md flex items-center justify-center gap-2";
  
  const variants = {
    primary: "bg-yellow-500 text-red-900 hover:bg-yellow-400 border-b-4 border-yellow-700 disabled:opacity-50 disabled:cursor-not-allowed",
    secondary: "bg-gray-800 text-white hover:bg-gray-700 border border-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",
    correct: "bg-green-600 text-white border-b-4 border-green-800",
    incorrect: "bg-red-600 text-white border-b-4 border-red-800 opacity-60",
    option: "bg-white/10 text-white hover:bg-white/20 border border-white/20 backdrop-blur-sm text-lg"
  };

  return (
    <button 
      onClick={onClick} 
      disabled={disabled}
      className={`${baseStyle} ${variants[variant]} ${className}`}
    >
      {children}
    </button>
  );
};

const ResultCard = ({ score, total, onRestart }) => {
  let title = "";
  let message = "";
  let icon = null;

  const percentage = (score / total) * 100;

  if (percentage === 100) {
    title = "BLOCKBUSTER HIT!";
    message = "Superstar! You know your Bollywood inside out!";
    icon = <Star className="w-16 h-16 text-yellow-400 animate-spin-slow" />;
  } else if (percentage >= 70) {
    title = "SUPER HIT!";
    message = "Great job! Almost a classic performance.";
    icon = <Award className="w-16 h-16 text-blue-400" />;
  } else if (percentage >= 40) {
    title = "AVERAGE";
    message = "Not bad, but you need a re-watch session.";
    icon = <Film className="w-16 h-16 text-gray-400" />;
  } else {
    title = "FLOP SHOW";
    message = "Better luck next time! Time to binge-watch some classics.";
    icon = <RotateCcw className="w-16 h-16 text-red-400" />;
  }

  return (
    <div className="flex flex-col items-center justify-center space-y-6 text-center animate-fadeIn p-8 bg-black/40 rounded-2xl border-2 border-yellow-500/30 backdrop-blur-md max-w-md w-full">
      <div className="bg-gradient-to-br from-purple-900/50 to-red-900/50 p-6 rounded-full shadow-2xl border border-white/10">
        {icon}
      </div>
      <div>
        <h2 className="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-red-500 mb-2 font-serif tracking-wide">
          {title}
        </h2>
        <p className="text-gray-300 text-lg">{message}</p>
      </div>
      <div className="text-6xl font-black text-white drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]">
        {score}<span className="text-3xl text-gray-400">/{total}</span>
      </div>
      <Button onClick={onRestart} variant="primary" className="w-full text-xl mt-4">
        <RotateCcw className="w-5 h-5" /> Play Again
      </Button>
    </div>
  );
};

const QuizScreen = ({ data, currentQuestionIndex, onAnswer, score }) => {
  const [selectedOption, setSelectedOption] = useState(null);
  const [isAnswered, setIsAnswered] = useState(false);
  const question = data[currentQuestionIndex];

  // Reset state when question changes
  useEffect(() => {
    setSelectedOption(null);
    setIsAnswered(false);
  }, [currentQuestionIndex]);

  const handleOptionClick = (option) => {
    if (isAnswered) return;
    setSelectedOption(option);
    setIsAnswered(true);
    
    // Delay slightly to show the result before moving (handled by parent usually, but here we just show state)
    // We will let the user click "Next" manually to read the answer
  };

  const getButtonVariant = (option) => {
    if (!isAnswered) return 'option';
    if (option === question.correct) return 'correct';
    if (option === selectedOption) return 'incorrect';
    return 'option'; // Remaining unselected incorrect options
  };

  return (
    <div className="w-full max-w-2xl flex flex-col items-center animate-slideUp">
      
      {/* Progress & Score Header */}
      <div className="w-full flex justify-between items-center mb-6 px-4 py-3 bg-black/30 rounded-full border border-white/10 backdrop-blur-sm">
        <div className="flex items-center gap-2">
          <Clapperboard className="w-5 h-5 text-yellow-500" />
          <span className="text-yellow-100 font-semibold">Scene {currentQuestionIndex + 1}/{data.length}</span>
        </div>
        <div className="flex items-center gap-2">
          <Star className="w-5 h-5 text-yellow-500 fill-yellow-500" />
          <span className="text-yellow-100 font-bold text-lg">{score}</span>
        </div>
      </div>

      {/* Dialogue Card */}
      <div className="relative w-full bg-gradient-to-b from-gray-900 to-black p-8 rounded-2xl border border-yellow-500/20 shadow-2xl mb-8 group">
        
        {/* Decorative elements simulating a film reel/frame */}
        <div className="absolute top-0 left-0 w-full h-3 bg-repeat-x opacity-20" style={{ backgroundImage: 'linear-gradient(90deg, transparent 50%, #000 50%)', backgroundSize: '20px 100%' }}></div>
        <div className="absolute bottom-0 left-0 w-full h-3 bg-repeat-x opacity-20" style={{ backgroundImage: 'linear-gradient(90deg, transparent 50%, #000 50%)', backgroundSize: '20px 100%' }}></div>

        <div className="text-center space-y-4">
            <div className="inline-block p-3 rounded-full bg-yellow-900/20 border border-yellow-500/20 mb-2">
                <Volume2 className="w-8 h-8 text-yellow-500" />
            </div>
            <h3 className="text-2xl md:text-3xl font-serif font-bold text-white leading-relaxed italic drop-shadow-lg">
            "{question.dialogue}"
            </h3>
            
            {isAnswered && (
            <div className="animate-fadeIn mt-4 p-3 bg-green-900/20 border border-green-500/30 rounded-lg">
                <p className="text-green-300 font-medium text-sm">
                Correct Answer: <span className="font-bold text-white">{question.correct}</span>
                </p>
                <p className="text-gray-400 text-xs mt-1">Said by: {question.actor}</p>
            </div>
            )}
        </div>
      </div>

      {/* Options Grid */}
      <div className="w-full grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
        {question.options.map((option, idx) => (
          <Button
            key={idx}
            onClick={() => handleOptionClick(option)}
            variant={getButtonVariant(option)}
            disabled={isAnswered}
            className="w-full text-left justify-start pl-6 transition-all duration-300 h-16"
          >
            <span className="opacity-50 mr-2 text-sm font-mono">0{idx + 1}</span>
            {option}
          </Button>
        ))}
      </div>

      {/* Next Button */}
      {isAnswered && (
        <Button 
          onClick={() => onAnswer(selectedOption === question.correct)} 
          variant="primary" 
          className="w-full md:w-auto min-w-[200px] animate-bounce-short"
        >
          Next Dialogue <SkipForward className="w-5 h-5 ml-2" />
        </Button>
      )}
    </div>
  );
};

// --- Main App Component ---

export default function App() {
  const [started, setStarted] = useState(false);
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [showResult, setShowResult] = useState(false);

  const startQuiz = () => {
    setStarted(true);
    setScore(0);
    setCurrentQuestionIndex(0);
    setShowResult(false);
  };

  const handleNextQuestion = (isCorrect) => {
    if (isCorrect) {
      setScore(score + 1);
    }

    const nextIndex = currentQuestionIndex + 1;
    if (nextIndex < quizData.length) {
      setCurrentQuestionIndex(nextIndex);
    } else {
      setShowResult(true);
    }
  };

  // Background pattern for "cinematic" feel
  const bgPattern = {
    backgroundImage: `radial-gradient(circle at 50% 50%, rgba(50, 0, 0, 0) 0%, rgba(0, 0, 0, 0.8) 100%), 
                      repeating-linear-gradient(45deg, #1a1a1a 0, #1a1a1a 1px, transparent 0, transparent 50%)`,
    backgroundSize: '100% 100%, 20px 20px',
    backgroundColor: '#0f0f12'
  };

  return (
    <div className="min-h-screen text-gray-100 font-sans flex flex-col items-center overflow-hidden relative" style={bgPattern}>
      
      {/* Decorative Spotlights */}
      <div className="absolute top-0 left-1/4 w-32 h-64 bg-yellow-500/10 blur-[60px] transform -rotate-12 pointer-events-none"></div>
      <div className="absolute top-0 right-1/4 w-32 h-64 bg-red-500/10 blur-[60px] transform rotate-12 pointer-events-none"></div>

      {/* Header / Marquee */}
      <header className="w-full py-6 z-10 text-center relative">
        <div className="absolute inset-0 bg-gradient-to-b from-black to-transparent opacity-80 pointer-events-none"></div>
        <h1 className="relative text-4xl md:text-6xl font-black text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 drop-shadow-[0_4px_4px_rgba(0,0,0,0.8)] tracking-wider uppercase" style={{ fontFamily: 'serif' }}>
          Filmy Quiz
        </h1>
        <p className="relative text-yellow-200/60 mt-2 text-sm md:text-base font-medium tracking-widest uppercase">The Ultimate Bollywood Challenge</p>
      </header>

      {/* Main Content Area */}
      <main className="flex-1 w-full max-w-4xl p-4 md:p-8 flex flex-col items-center justify-center relative z-10">
        
        {!started ? (
          // Welcome Screen
          <div className="text-center space-y-8 animate-fadeIn max-w-lg mx-auto bg-black/40 p-10 rounded-3xl border border-white/5 backdrop-blur-sm">
            <div className="relative inline-block">
               <div className="absolute inset-0 bg-yellow-500 blur-xl opacity-20 rounded-full animate-pulse"></div>
               <Film className="w-24 h-24 text-yellow-500 relative z-10" />
            </div>
            
            <div className="space-y-4">
              <h2 className="text-3xl font-bold text-white">Ready for the Show?</h2>
              <p className="text-gray-400">
                Think you know your Hindi cinema? Prove you are the ultimate Bollywood fan by guessing the movie for these iconic lines!
              </p>
            </div>

            <Button onClick={startQuiz} variant="primary" className="w-full text-xl shadow-[0_0_20px_rgba(234,179,8,0.3)] hover:shadow-[0_0_30px_rgba(234,179,8,0.5)]">
              Start Action!
            </Button>
            
            <div className="pt-4 flex justify-center gap-4 text-xs text-gray-500 uppercase tracking-widest">
                <span>Drama</span> ‚Ä¢ <span>Action</span> ‚Ä¢ <span>Romance</span>
            </div>
          </div>
        ) : showResult ? (
          // Result Screen
          <ResultCard score={score} total={quizData.length} onRestart={startQuiz} />
        ) : (
          // Quiz Screen
          <QuizScreen 
            data={quizData} 
            currentQuestionIndex={currentQuestionIndex} 
            onAnswer={handleNextQuestion}
            score={score}
          />
        )}
      </main>

      {/* Footer */}
      <footer className="w-full py-4 text-center text-gray-600 text-sm relative z-10 bg-black/50 backdrop-blur-md border-t border-white/5">
        <p>
          Made with üçø for Bollywood Lovers by{' '}
          <a 
            href="https://www.hackerrank.com/profile/ashishknanda" 
            target="_blank" 
            rel="noopener noreferrer" 
            className="text-yellow-500 hover:text-yellow-400 hover:underline transition-colors"
          >
            Ashish Kumar
          </a>
        </p>
      </footer>

      {/* CSS Animation Styles (Usually in index.css, included here for single-file portability) */}
      <style>{`
        @keyframes fadeIn {
          from { opacity: 0; transform: scale(0.95); }
          to { opacity: 1; transform: scale(1); }
        }
        @keyframes slideUp {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @keyframes bounceShort {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
        .animate-slideUp { animation: slideUp 0.5s ease-out forwards; }
        .animate-spin-slow { animation: spin 8s linear infinite; }
        .animate-bounce-short { animation: bounceShort 1s ease-in-out infinite; }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
      `}</style>
    </div>
  );
}
